<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quick Buy</title>
  <link rel="icon" href="LOGO Quick Buy.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Shrikhand&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
    }

    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 30px;
      background-color: white;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Shrikhand', cursive;
    }

    .logo img {
      width: 30px;
      height: 30px;
    }

    .logo .highlight {
      color: #f9af23;
    }
    
    .viviene {
      color: blue;
    }
    
    .er {
      color: blue;
    }

    .nav-links {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .nav-links a {
      text-decoration: none;
      color: black;
      font-size: 16px;
    }

    .nav-links a:hover {
      font-weight: bold;
    }

    .icons {
      display: flex;
      gap: 15px;
      align-items: center;
      position: relative;
    }

    .user-dropdown {
      position: relative;
      display: inline-block;
    }

    .user-dropdown-content {
      display: none;
      position: absolute;
      top: 35px;
      right: 0;
      background-color: white;
      min-width: 160px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      z-index: 1001;
      border-radius: 8px;
    }

    .user-dropdown-content a {
      color: black;
      padding: 10px 16px;
      text-decoration: none;
      display: block;
    }

    .user-dropdown-content a:hover {
      background-color: #f0f0f0;
    }

    .user-dropdown:hover .user-dropdown-content {
      display: block;
    }

    .user-icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      object-fit: cover;
    }

    .shop-section {
      position: relative;
      background: linear-gradient(to right, #2b67a0 30%, #f8b133 70%);
      padding-top: 0;
      padding-bottom: 30px;
      z-index: 0;
      overflow: hidden;
    }

    .main-image {
      width: 100%;
      height: 450px;
      object-fit: cover;
      display: block;
      position: relative;
      z-index: 1;
    }

    .shop-container {
      max-width: 1200px;
      margin: auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      position: relative;
      top: -120px;
      z-index: 2;
    }

    .shop-header {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      padding-bottom: 20px;
    }

    .shop-header .search-bar {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .shop-header input[type="text"] {
      padding: 8px 15px;
      border: 2px solid #ccc;
      border-radius: 20px;
      width: 250px;
    }

    .shop-header button {
      padding: 8px 15px;
      background-color: #2b67a0;
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
    }

    .content {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }

    .sidebar {
      width: 200px;
    }

    .sidebar h3 {
      margin-bottom: 10px;
    }

    .sidebar ul {
      list-style: none;
      padding-left: 0;
    }

    .sidebar li {
      margin: 10px 0;
      cursor: pointer;
      padding: 8px 5px;
      border-radius: 5px;
      transition: background-color 0.2s;
    }

    .sidebar li:hover {
      background-color: #f0f0f0;
    }

    .sidebar li.active {
      background-color: #e6f2ff;
      font-weight: bold;
      color: #4267b2;
    }

    .products {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }

    .product-card {
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      background-color: #fafafa;
      transition: transform 0.2s, box-shadow 0.2s;
      height: 320px; /* Fixed height */
      display: flex;
      flex-direction: column;
      overflow: hidden;
      cursor: pointer;
    }

    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .product-card img {
      width: 100%;
      height: 150px;
      object-fit: contain;
      background: #f4f4f4;
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .product-card h4 {
      margin: 5px 0;
      font-size: 16px;
      height: 40px;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      line-clamp: 2;
      -moz-line-clamp: 2;
      -ms-line-clamp: 2;
      box-orient: vertical;
      -moz-box-orient: vertical;
      -ms-box-orient: vertical;
    }

    .product-card .price {
      color: #333;
      font-weight: bold;
      margin: 5px 0;
    }

    .buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: auto; /* Push buttons to bottom */
    }

    .add-to-cart {
      background-color: #858585;
      color: white;
    }

    .add-to-cart:hover {
      background-color: #6e6e6e;
    }

    .buy-now {
      background-color: #000000;
      color: white;
    }

    .buy-now:hover {
      background-color: #333333;
    }

    .badge {
      background: orange;
      color: white;
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 5px;
      margin-left: 5px;
    }

    .cart-icon {
      width: 28px;
      height: 28px;
      cursor: pointer;
    }

    .cart-count {
      position: absolute;
      top: -5px;
      right: 35px;
      background-color: #f9af23;
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .gradient-banner {
      width: 100%;
      height: 150px;
      margin: 50px auto 40px;
      padding: 30px 40px;
      border-radius: 16px;
      background: linear-gradient(135deg, #a3ccff, #3e7fb6, #e7a72b);
      color: white;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .brand {
      background: white;
      color: #f7931e;
      display: inline-block;
      padding: 2px 8px;     /* smaller padding */
      border-radius: 9999px; /* fully rounded */
      font-weight: bold;
      font-size: 0.9rem;
      width: fit-content;   /* shrink to text */
    }

    .brand span {
      color: #007bff;
    }

    .gradient-banner p {
      margin: 0;
      font-weight: bold;
      font-size: 1rem;
      max-width: 600px;
    }

    .footer-container {
      width: 100%;
      padding: 40px 5%;
      border-top: 4px solid black;
      border-bottom: 4px solid black;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      position: relative;
    }

    .footer-section {
      width: 30%;
      min-height: 150px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .footer-center {
      text-align: center;
      font-size: 14px;
      color: #777;
    }

    .footer-center .location {
      margin-top: 10px;
      font-weight: bold;
    }

    .social-icons {
      margin-top: 12px;
      font-size: 18px;
    }

    .social-icons i {
      margin: 0 6px;
      cursor: pointer;
    }

    .footer-links {
      font-size: 14px;
      display: flex;
      justify-content: space-between;
    }

    .footer-links div h4 {
      margin: 0 0 6px;
      font-size: 15px;
      color: black;
    }

    .footer-links a {
      display: block;
      text-decoration: none;
      color: black;
      margin: 2px 0;
    }

    /* Vertical black dividers */
    .footer-container::before,
    .footer-container::after {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      width: 4px;
      background-color: black;
    }

    .footer-container::before {
      left: 33.3%;
    }

    .footer-container::after {
      left: 66.6%;
    }

    .footer-spike {
      width: 4px;
      height: 30px;
      background: black;
      margin: 0 auto;
    }

    .divider {
      margin-top: 3%;
      height: 2px;
      background-color: black;
      border: none;
      width: 100%;
    }

    .pagination {
      text-align: center;
      padding-top: 30px;
      padding-bottom: 10px;
    }

    .pagination button {
      background: none;
      border: none;
      font-size: 16px;
      color: #888;
      cursor: pointer;
    }

    .pagination span {
      margin: 0 10px;
      cursor: pointer;
    }

    .pagination span.active {
      font-weight: bold;
      color: #4267b2;
    }

    .category-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 20px;
      font-size: 12px;
      background-color: #e9f5fe;
      color: #4267b2;
      margin-bottom: 5px;
    }

    .empty-products {
      grid-column: 1 / -1;
      text-align: center;
      padding: 50px 0;
      color: #888;
    }

    .empty-products i {
      font-size: 50px;
      margin-bottom: 20px;
      color: #ddd;
    }

    /* Success/Error Messages */
    .message {
      padding: 10px 15px;
      border-radius: 5px;
      margin: 15px 0;
    }

    .success-message {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .error-message {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    /* Recommendations section */
    .recommendations {
      padding: 30px 20px;
      background-color: white;
    }

    .recommendations h2 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 30px;
      text-align: left;
    }

    .recommendation-cards {
      display: flex;
      flex-wrap: nowrap;
      gap: 24px;
      overflow-x: auto;
    }

    .recommendation-card {
      background-color: #f2f2f2;
      border-radius: 20px;
      width: 220px;
      padding: 20px;
      flex-shrink: 0;
      text-align: center;
      cursor: pointer;
    }

    .recommendation-image-container {
      background: #ddd;
      padding: 15px;
      border-radius: 12px;
    }

    .recommendation-image {
      width: 100%;
      height: 160px;
      object-fit: contain;
    }

    .recommendation-title {
      margin: 12px 0 4px;
      font-weight: 600;
    }

    .recommendation-reviews {
      color: #888;
      font-size: 13px;
      margin-bottom: 5px;
    }

    .recommendation-price {
      font-weight: bold;
      font-size: 16px;
      margin: 5px 0;
    }

    .recommendation-add-to-cart {
      margin-top: 6px;
      background: white;
      border: 2px solid black;
      padding: 8px 14px;
      border-radius: 20px;
      font-weight: bold;
      margin-right: 4px;
      cursor: pointer;
    }

    .recommendation-buy-now {
      margin-top: 6px;
      background: black;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 20px;
      font-weight: bold;
      cursor: pointer;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .content {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        margin-bottom: 20px;
      }
      
      .shop-header {
        flex-direction: column;
        align-items: stretch;
      }
      
      .shop-header .search-bar {
        width: 100%;
      }
      
      .shop-header input[type="text"] {
        width: 100%;
      }
    }

    /* User email in dropdown */
    .user-email {
      font-weight: bold;
      color: #4267b2;
      padding: 10px 16px;
      border-bottom: 1px solid #eee;
    }

    /* Loading spinner */
    .loading-spinner {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
    }

    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border-left-color: #4267b2;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <header class="navbar">
    <div class="logo">
    <img src="LOGO Quick Buy.png" alt="Be a Quick Buyer Logo" onerror="this.src='LOGO Quick Buy.png'">
      <span class="viviene">Be a <span class="highlight">Quick Buy<span class="er">er</span></span>
    </div>
    <nav class="nav-links">
     
    </nav>
    <div class="icons">
      <!-- Cart icon with counter -->
      <a href="PROFILE.html"><img class="cart-icon" src="CARTTTTTT.jpg" alt="Cart Icon" onerror="this.src='CARTTTTTT.jpg'"></a>
      <span id="cart-count" class="cart-count">0</span>

      <div class="user-dropdown">
        <img id="user-icon" src="LOGO Quick Buy.png" alt="User Icon" class="user-icon" onerror="this.src='LOGO Quick Buy.png'">
        <div class="user-dropdown-content">
          <div id="user-email" class="user-email">User</div>
          <a href="PROFILE.html">My Account</a>
          <a href="PROFILE.html">My Purchase</a>
          <a href="QUICKBUY LOGIN.html">Log Out</a>
        </div>
      </div>
    </div>
  </header>

  <main>
    <!-- Message Container -->
    <div id="message-container" class="message" style="display: none; max-width: 1200px; margin: 20px auto;"></div>

    <section class="shop-section">
      <img src="keziah.png" alt="Shopping Online" class="main-image" onerror="this.src='Product Image (1).png'">

      <div class="shop-container">
        <div class="shop-header">
          <div class="search-bar">
            <input type="text" id="search-input" placeholder="Search on QuickBuy">
            <button onclick="searchProducts()">Search</button>
          </div>
        </div>

        <div class="content">
          <div class="sidebar">
            <h3>Category</h3>
            <ul id="category-list">
              <li data-category="all" class="active">All Product <span class="badge"></span></li>
              <li data-category="For Home">For Home</li>
              <li data-category="For Phone">For Phone</li>
              <li data-category="Electronics">Electronics</li>
              <li data-category="Clothing">Clothing</li>
              <li data-category="Accessories">Accessories</li>
              <li data-category="Beauty">Beauty</li>
              <li data-category="Food">Food</li>
              <li data-category="Other">Other</li>
            </ul>
            <br/>
            <h4>Filters</h4>
            <ul>
              <li onclick="filterByNewest()">New Arrival</li>
              <li onclick="filterByPopularity()">Best Seller</li>
              <li onclick="filterByPrice('low')">Price: Low to High</li>
              <li onclick="filterByPrice('high')">Price: High to Low</li>
            </ul>
          </div>

          <div id="products-container" class="products">
            <!-- Products will be dynamically loaded here -->
          </div>
        </div>
        
        <hr style="margin-top: 3%; height: 2px; background-color: black; border: none; width: 100%;">

        <div style="text-align: center; padding-top: 30px; padding-bottom: 10px;" id="pagination">
          <!-- Pagination will be dynamically generated -->
        </div>
        
        <section style="padding: 30px 20px; background-color: white;">
          <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 30px; text-align: left;">
            Explore our recommendations
          </h2>
          <div id="recommendations-container" style="display: flex; flex-wrap: nowrap; gap: 24px; overflow-x: auto;">
            <!-- Recommendations will be dynamically loaded here -->
          </div>
        </section>
        
        <div class="gradient-banner">
          <div class="brand">Quick<span>Buy</span></div>
          <p>We'll listen to your needs, identify the best approach, and then create a best solution for you.</p>
        </div>

        <div class="footer-container">
          <div class="footer-section"></div>

          <div class="footer-section footer-center">
            <p>917-123-4567</p>
            <p>quickbuy@gmail.com</p>
            <p class="location">Philippines</p>
            <div class="social-icons">
              <i class="fab fa-facebook"></i>
              <i class="fab fa-instagram"></i>
              <i class="fab fa-x-twitter"></i>
            </div>
          </div>

          <div class="footer-section footer-links">
            <div>
              <h4>About</h4>
              <a href="#">Blog</a>
              <a href="#">Meet the team</a>
              <a href="#">Contact Us</a>
            </div>
            <div>
              <h4>Support</h4>
              <a href="#">Contact Us</a>
              <a href="#">Shipping</a>
              <a href="#">FAQ</a>
            </div>
          </div>
        </div>

        <div class="footer-spike"></div>

      </div>
    </section>
  </main>

  <script>
    // Replace the existing imageLibrary object with this simplified version
    const imageLibrary = {
      // Store for custom images
      customImages: {},
      
      // Initialize from localStorage
      init: function() {
        const stored = localStorage.getItem('quickBuyImageLibrary');
        if (stored) {
          try {
            this.customImages = JSON.parse(stored);
          } catch (e) {
            console.error('Error loading image library:', e);
            this.customImages = {};
          }
        }
      },
      
      // Get image by ID
      getImage: function(imageId) {
        return imageId && this.customImages[imageId] ? this.customImages[imageId] : null;
      }
    };
    
    // Global variables
    let allProducts = [];
    let currentCategory = 'all';
    let currentPage = 1;
    const productsPerPage = 12;
    let currentSearchTerm = '';
    let currentSortMethod = '';
    
    // Initialize cart if it doesn't exist
    if (!localStorage.getItem('quickBuyCart')) {
      localStorage.setItem('quickBuyCart', JSON.stringify([]));
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      // Load user data if logged in
      const userEmail = localStorage.getItem('userEmail');
      if (userEmail) {
        document.getElementById('user-email').textContent = userEmail;
      }
      
      // Load cart count
      updateCartCount();
      
      // Load user profile picture
      loadUserProfilePicture();
      
      // Load all products from all sellers
      loadAllProducts();
      
      // Set up category filtering
      setupCategoryFilters();
      
      // Load recommendations
      loadRecommendations();
      
      // Add click handler for user icon
      const userIcon = document.getElementById('user-icon');
      if (userIcon) {
        userIcon.addEventListener('click', function(event) {
          // Prevent default action (opening dropdown)
          event.stopPropagation();
          
          // Create file input
          const fileInput = document.createElement('input');
          fileInput.type = 'file';
          fileInput.accept = 'image/*';
          
          // Add change listener
          fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            
            if (!file) return;
            
            if (!file.type.match('image.*')) {
              showMessage('Please select an image file.', 'error');
              return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
              // Store the image data in a data URL format
              const imageData = e.target.result;
              
              // Compress image before saving
              compressImage(imageData, 300, 300, 0.7)
                .then(compressedImage => {
                  // Update user profile picture with compressed image
                  updateUserProfilePicture(compressedImage);
                })
                .catch(error => {
                  showMessage('Error processing image: ' + error.message, 'error');
                });
            };
            
            reader.readAsDataURL(file);
          });
          
          // Trigger file selection
          fileInput.click();
        });
      }
    });
    
    function loadAllProducts() {
      const sellerProducts = JSON.parse(localStorage.getItem('sellerProducts') || '{}');
      allProducts = [];
      
      // Collect all active products from all sellers
      for (const sellerEmail in sellerProducts) {
        const products = sellerProducts[sellerEmail];
        products.forEach(product => {
          if (product.status !== 'inactive' && product.image) {
            // Add seller email to product data
            allProducts.push({
              ...product,
              sellerEmail: sellerEmail
            });
          }
        });
      }
      
      // Sort products by creation date (newest first)
      allProducts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      
      displayProducts();
    }
    
    function updateUserProfilePicture(compressedImage) {
      // Get user email
      const userEmail = localStorage.getItem('userEmail');
      if (!userEmail) return;
      
      // Get user data
      const users = JSON.parse(localStorage.getItem('quickBuyUsers') || '{}');
      const userData = users[userEmail] || {};
      
      // Update profile picture
      userData.profilePicture = compressedImage;
      users[userEmail] = userData;
      
      // Save updated user data
      localStorage.setItem('quickBuyUsers', JSON.stringify(users));
      
      // Update profile picture in UI
      loadUserProfilePicture();
    }
    
    function updateCategoryCounts() {
      // Count products in each category
      const categoryCounts = {
        all: allProducts.length
      };
      
      allProducts.forEach(product => {
        if (!categoryCounts[product.category]) {
          categoryCounts[product.category] = 0;
        }
        categoryCounts[product.category]++;
      });
      
      // Update category badges
      const categoryItems = document.querySelectorAll('#category-list li');
      categoryItems.forEach(item => {
        const category = item.getAttribute('data-category');
        const count = categoryCounts[category] || 0;
        
        // Add or update badge
        let badge = item.querySelector('.badge');
        if (!badge) {
          badge = document.createElement('span');
          badge.className = 'badge';
          item.appendChild(badge);
        }
        
        badge.textContent = count;
      });
    }
    
    function displayProducts() {
      const container = document.getElementById('products-container');
      container.innerHTML = '';
      
      if (allProducts.length === 0) {
        container.innerHTML = `
          <div class="empty-products">
            <i class="fas fa-box-open"></i>
            <h3>No products available</h3>
            <p>Check back later for new products!</p>
          </div>
        `;
        return;
      }
      
      // Filter products based on current category
      let filteredProducts = allProducts;
      if (currentCategory !== 'all') {
        filteredProducts = allProducts.filter(product => product.category === currentCategory);
      }
      
      // Filter products based on search term
      if (currentSearchTerm) {
        const searchLower = currentSearchTerm.toLowerCase();
        filteredProducts = filteredProducts.filter(product => 
          product.name.toLowerCase().includes(searchLower) ||
          product.description.toLowerCase().includes(searchLower)
        );
      }
      
      // Sort products based on current sort method
      switch (currentSortMethod) {
        case 'newest':
          filteredProducts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
          break;
        case 'popular':
          // Sort by stock (assuming lower stock means more popular)
          filteredProducts.sort((a, b) => a.stock - b.stock);
          break;
        case 'price-low':
          filteredProducts.sort((a, b) => a.price - b.price);
          break;
        case 'price-high':
          filteredProducts.sort((a, b) => b.price - a.price);
          break;
      }
      
      // Calculate pagination
      const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
      const startIndex = (currentPage - 1) * productsPerPage;
      const endIndex = startIndex + productsPerPage;
      const productsToShow = filteredProducts.slice(startIndex, endIndex);
      
      // Display products
      productsToShow.forEach(product => {
        const card = document.createElement('div');
        card.className = 'product-card';
        
        // Make the entire card clickable
        card.style.cursor = 'pointer';
        card.onclick = function(event) {
          // Only navigate if the click wasn't on a button
          if (event.target.tagName !== 'BUTTON') {
            viewProductDetail(product.id);
          }
        };
        
        // Format price
        const formattedPrice = new Intl.NumberFormat('en-PH', {
          style: 'currency',
          currency: 'PHP'
        }).format(product.price);
        
        card.innerHTML = `
          <img src="${product.image}" alt="${product.name}" onerror="this.src='LOGO Quick Buy.png'">
          <h4>${product.name}</h4>
          <span class="category-badge">${product.category}</span>
          <div class="price">${formattedPrice}</div>
          <div class="buttons">
            <button class="add-to-cart" onclick="addToCart(${product.id})">Add to Cart</button>
            <button class="buy-now" onclick="buyNow(${product.id})">Buy Now</button>
          </div>
        `;
        
        container.appendChild(card);
      });
      
      // Update pagination
      updatePagination(totalPages);
    }
    
    function updatePagination(totalPages) {
      const paginationContainer = document.getElementById('pagination');
      paginationContainer.innerHTML = '';
      
      // Previous button
      const prevButton = document.createElement('button');
      prevButton.style.background = 'none';
      prevButton.style.border = 'none';
      prevButton.style.fontSize = '16px';
      prevButton.style.color = '#888';
      prevButton.style.cursor = 'pointer';
      prevButton.textContent = '← Previous';
      prevButton.disabled = currentPage === 1;
      prevButton.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          displayProducts();
          window.scrollTo(0, 0);
        }
      });
      paginationContainer.appendChild(prevButton);
      
      // Page numbers
      const maxVisiblePages = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
      let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
      
      // Adjust start page if we're near the end
      if (endPage - startPage + 1 < maxVisiblePages) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
      }
      
      // Page numbers
      for (let i = 1; i <= totalPages; i++) {
        if (i === 1 || i === totalPages || (i >= startPage && i <= endPage)) {
          const pageSpan = document.createElement('span');
          pageSpan.style.margin = '0 10px';
          pageSpan.style.cursor = 'pointer';
          if (i === currentPage) {
            pageSpan.style.fontWeight = 'bold';
          }
          pageSpan.textContent = i;
          pageSpan.addEventListener('click', () => {
            currentPage = i;
            displayProducts();
            window.scrollTo(0, 0);
          });
          paginationContainer.appendChild(pageSpan);
        } else if (i === startPage - 1 || i === endPage + 1) {
          const ellipsis = document.createElement('span');
          ellipsis.style.margin = '0 10px';
          ellipsis.textContent = '...';
          paginationContainer.appendChild(ellipsis);
        }
      }
      
      // Next button
      const nextButton = document.createElement('button');
      nextButton.style.background = 'none';
      nextButton.style.border = 'none';
      nextButton.style.fontSize = '16px';
      nextButton.style.color = '#888';
      nextButton.style.cursor = 'pointer';
      nextButton.textContent = 'Next →';
      nextButton.disabled = currentPage === totalPages;
      nextButton.addEventListener('click', () => {
        if (currentPage < totalPages) {
          currentPage++;
          displayProducts();
          window.scrollTo(0, 0);
        }
      });
      paginationContainer.appendChild(nextButton);
    }
    
    function setupCategoryFilters() {
      const categoryItems = document.querySelectorAll('#category-list li');
      
      categoryItems.forEach(item => {
        item.addEventListener('click', function() {
          // Remove active class from all items
          categoryItems.forEach(i => i.classList.remove('active'));
          
          // Add active class to clicked item
          this.classList.add('active');
          
          // Update current category
          currentCategory = this.getAttribute('data-category');
          
          // Reset to first page
          currentPage = 1;
          
          // Display products with new filter
          displayProducts();
        });
      });
    }
    
    function searchProducts() {
      const searchInput = document.getElementById('search-input');
      currentSearchTerm = searchInput.value.trim();
      
      // Reset to first page
      currentPage = 1;
      
      // Display products with search filter
      displayProducts();
    }
    
    function filterByNewest() {
      currentSortMethod = 'newest';
      currentPage = 1;
      displayProducts();
    }
    
    function filterByPopularity() {
      currentSortMethod = 'popular';
      currentPage = 1;
      displayProducts();
    }
    
    function filterByPrice(direction) {
      currentSortMethod = direction === 'low' ? 'price-low' : 'price-high';
      currentPage = 1;
      displayProducts();
    }
    
    function loadRecommendations() {
      const container = document.getElementById('recommendations-container');
      
      // Get a random selection of products for recommendations
      const recommendedProducts = [...allProducts]
        .sort(() => Math.random() - 0.5)
        .slice(0, 5);
      
      // Clear container
      container.innerHTML = '';
      
      // Add each recommendation to the container
      recommendedProducts.forEach(product => {
        // Format price
        const formattedPrice = new Intl.NumberFormat('en-PH', {
          style: 'currency',
          currency: 'PHP'
        }).format(product.price);
        
        // Generate random review count
        const reviewCount = Math.floor(Math.random() * 2000) + 100;
        
        // Use the actual image data
        const imageUrl = product.image || '';
        
        const card = document.createElement('div');
        card.style.backgroundColor = '#f2f2f2';
        card.style.borderRadius = '20px';
        card.style.width = '220px';
        card.style.padding = '20px';
        card.style.flexShrink = '0';
        card.style.textAlign = 'center';
        card.style.cursor = 'pointer';
        
        // Make the card clickable except for buttons
        card.onclick = function(event) {
          if (event.target.tagName !== 'BUTTON') {
            viewProductDetail(product.id);
          }
        };
        
        card.innerHTML = `
          <div style="background: #ddd; padding: 15px; border-radius: 12px;">
            <img src="${imageUrl}" alt="${product.name}" style="width: 100%; height: 160px; object-fit: contain;" onerror="this.style.display='none'">
          </div>
          <span class="category-badge" style="margin-top: 10px; display: inline-block;">${product.category}</span>
          <p style="margin: 12px 0 4px; font-weight: 600;">${product.name}</p>
          <div style="color: #ffaa00; font-size: 13px; margin-bottom: 5px;">
            <span style="color: #888;">(${reviewCount} Reviews)</span>
          </div>
          <div style="font-weight: bold; font-size: 16px; margin: 5px 0;">${formattedPrice}</div>
          ${product.stock > 0 ? `
            <button onclick="addToCart(${product.id})" style="margin-top: 6px; background: white; border: 2px solid black; padding: 8px 14px; border-radius: 20px; font-weight: bold; margin-right: 4px; cursor: pointer;">
              Add to Cart
            </button>
            <button onclick="buyNow(${product.id})" style="margin-top: 6px; background: black; color: white; border: none; padding: 8px 14px; border-radius: 20px; font-weight: bold; cursor: pointer;">
              Buy Now
            </button>
          ` : `
            <button disabled style="margin-top: 6px; background: #ccc; border: none; padding: 8px 14px; border-radius: 20px; font-weight: bold; color: white;">
              Out of Stock
            </button>
          `}
        `;
        
        container.appendChild(card);
      });
    }
    
    function addToCart(productId) {
      // Find the product
      const product = allProducts.find(p => p.id == productId);
      
      if (!product) {
        showMessage('Product not found.', 'error');
        return;
      }
      
      // Get current cart
      const cart = JSON.parse(localStorage.getItem('quickBuyCart') || '[]');
      
      // Check if product already exists in cart
      const existingProductIndex = cart.findIndex(item => item.id == productId);
      
      if (existingProductIndex >= 0) {
        // Increment quantity if product already exists
        cart[existingProductIndex].quantity += 1;
      } else {
        // Add new product to cart
        cart.push({
          id: product.id,
          name: product.name,
          price: product.price,
          image: product.image,
          category: product.category,
          sellerEmail: product.sellerEmail,
          quantity: 1
        });
      }
      
      // Save updated cart
      localStorage.setItem('quickBuyCart', JSON.stringify(cart));
      
      // Update cart count
      updateCartCount();
      
      // Show success message
      showMessage(`${product.name} added to cart!`, 'success');
    }
    
    function buyNow(productId) {
      // Add to cart first
      addToCart(productId);
      
      // Redirect to checkout page
      window.location.href = 'checkout.html';
    }
    
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem('quickBuyCart') || '[]');
      const cartCount = document.getElementById('cart-count');
      
      // Update count
      cartCount.textContent = cart.length;
      
      // Hide count if cart is empty
      if (cart.length === 0) {
        cartCount.style.display = 'none';
      } else {
        cartCount.style.display = 'flex';
      }
    }

    function loadUserProfilePicture() {
      // Get user email and data
      const userEmail = localStorage.getItem('userEmail');
      if (!userEmail) return;
      
      const users = JSON.parse(localStorage.getItem('quickBuyUsers') || '{}');
      const userData = users[userEmail] || {};
      
      // Update profile picture if available
      if (userData.profilePicture) {
        // Update all instances of the user icon in the page
        const userIcons = document.querySelectorAll('.user-icon');
        userIcons.forEach(icon => {
          icon.src = userData.profilePicture;
        });
      }
    }

    function showMessage(message, type) {
      let messageContainer = document.getElementById('message-container');
      if (!messageContainer) {
        messageContainer = document.createElement('div');
        messageContainer.id = 'message-container';
        messageContainer.style.position = 'fixed';
        messageContainer.style.top = '20px';
        messageContainer.style.right = '20px';
        messageContainer.style.zIndex = '9999';
        messageContainer.style.padding = '15px 20px';
        messageContainer.style.borderRadius = '5px';
        messageContainer.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        messageContainer.style.display = 'none';
        document.body.appendChild(messageContainer);
      }
      messageContainer.textContent = message;
      messageContainer.className = type === 'error' ? 'error-message' : 'success-message';
      messageContainer.style.display = 'block';
      setTimeout(() => {
        messageContainer.style.display = 'none';
      }, 2500);
    }

    function viewProductDetail(productId) {
      window.location.href = `prodcut review.html?id=${productId}`;
    }
  </script>

</body>
</html>